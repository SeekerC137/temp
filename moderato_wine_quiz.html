<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MODERATO — Фудпейринг за 4 шага</title>
  <style>
    :root{
      --bg:#ffffff; --ink:#111111; --muted:#6f6f6f; --accent:#B38B59; --wine:#722F37;
      --border:#e9e9e9; --radius:14px; --shadow:0 10px 30px rgba(0,0,0,.06);
      --font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,"Noto Sans",sans-serif;
    }
    body{margin:0;background:#fff;color:var(--ink);font-family:var(--font);}
    .wrap{max-width:1000px;margin:24px auto;padding:0 16px;}
    #wine-quiz{max-width:880px;margin:24px auto;background:var(--bg);color:var(--ink);
      border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;}
    .wq-header {
      padding:28px 28px 8px;
      border-bottom:1px solid var(--border);
      background:#722F37;   /* винный цвет */
      color:#fff;           /* белый текст */
    }
    .wq-header .wq-kicker,
    .wq-header .wq-title,
    .wq-header .wq-sub {
      color:#fff;           /* чтобы заголовок и подзаголовок тоже были белыми */
    }
    .wq-kicker{text-transform:uppercase;letter-spacing:.12em;font-size:12px;color:var(--muted);margin-bottom:6px;}
    .wq-title{font-size:32px;line-height:1.15;letter-spacing:.02em;margin:0 0 8px 0;}
    .wq-sub{color:var(--muted);font-size:14px;margin:0 0 14px 0;}
    .wq-progress{height:6px;background:#f4f4f4;border-radius:8px;overflow:hidden;}
    .wq-progress>span{display:block;height:100%;width:0%;background:var(--accent);transition:width .35s ease;}
    .wq-body{padding:28px;}
    .wq-question{font-size:20px;letter-spacing:.02em;margin:0 0 18px 0;}
    .wq-options{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;}
    @media (max-width:720px){.wq-options{grid-template-columns:1fr;}}
    .wq-option{position:relative;padding:14px 16px;border:1px solid var(--border);
      border-radius:12px;background:#fff;cursor:pointer;text-align:left;
      transition:transform .08s ease, box-shadow .2s ease, border-color .2s ease;}
    .wq-option:hover{transform:translateY(-1px);box-shadow:0 8px 20px rgba(0,0,0,.06);border-color:#dedede;}
    .wq-option strong{display:block;font-size:16px;margin-bottom:4px;letter-spacing:.02em;}
    .wq-option small{color:var(--muted);font-size:12px;}
    .wq-nav{display:flex;gap:10px;justify-content:space-between;align-items:center;margin-top:18px;padding:0 28px 24px;}
    .wq-left,.wq-right{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .wq-btn{appearance:none;border:none;cursor:pointer;border-radius:999px;padding:12px 18px;
      font-weight:600;letter-spacing:.06em;text-transform:uppercase;background:#f6f6f6;color:#222;
      transition:transform .06s ease, box-shadow .2s ease, background .2s ease;text-decoration:none;display:inline-block;}
    .wq-btn:hover{transform:translateY(-1px);box-shadow:0 8px 20px rgba(0,0,0,.06);}
    .wq-btn:disabled{opacity:.5;cursor:not-allowed;}
    .wq-btn--accent{background:var(--wine);color:#fff;}
    .wq-btn--outline{background:#fff;border:1px solid var(--border);}
    .wq-result{border:1px dashed var(--border);border-radius:12px;padding:18px;background:#fff;}
    .wq-result h3{margin:0 0 8px 0;font-size:24px;letter-spacing:.02em;}
    .wq-tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;}
    .wq-tag{padding:6px 10px;border:1px solid var(--border);border-radius:999px;font-size:12px;color:var(--muted);background:#fff;}
    .wq-footnote{margin-top:14px;color:var(--muted);font-size:16px;}
    .wq-cta{margin-top:16px;padding:16px;border:1px solid var(--border);border-radius:12px;background:#fff;}
    .wq-cta p{margin:0 0 10px 0;}
    .wq-screen{opacity:0;transform:translateY(6px);animation:fadeIn .25s ease forwards;}
    @keyframes fadeIn{to{opacity:1;transform:none;}}
  </style>
</head>
<body>
  <div class="wrap"><div id="wine-quiz-root"></div></div>

  <script>
  (function(){
    // ===== НАСТРОЙКИ ВОПРОСОВ =====
    const QUESTIONS_BASE = [
      {
        id:"color",
        title:"",
        question:"Шаг 1. Цвет блюда. Какая «палитра» доминирует?",
        options:[
          {value:"red",   label:"Красное", hint:"Мясо, Дичь"},
          {value:"white", label:"Белое",  hint:"Рыба, Морепродукты, Курица"}
        ]
      },
      { id:"body",       question:"Шаг 2. Вес (тельность) блюда. Как ощущается текстура?", options:[] },
      { id:"intensity",  question:"Шаг 3. Способ приготовления и насыщенность блюда.",             options:[] },
      { id:"aroma",      question:"Шаг 4. Дополнительная ароматика: специи, пряности и соус — да или нет?",   options:[] }
    ];

    // ===== ДИНАМИЧЕСКИЕ HINT'Ы =====
    function hintsForBody(ans){
      const c = ans.color;
      if(c === "red"){
        return [
          {value:"light", label:"Лёгкое",  hint:"Кролик, Утка"},
          {value:"full",  label:"Тяжёлое", hint:"Стейк (рибай/стриплойн), Томлёная говядина, Баранина, BBQ"}
        ];
      }
      return [
        {value:"light", label:"Лёгкое",  hint:"Дорада, Треска"},
        {value:"full",  label:"Тяжёлое", hint:"Лосось, Скумбрия, Осетр"}
      ];
    }
    function hintsForIntensity(ans){
      const {color, body} = ans;
      if(color === "red" && body === "full"){
        return [
          {value:"bold",     label:"Жирное/солёное/кислое", hint:"Рибай"},
          {value:"delicate", label:"Нежное",                 hint:"Филе миньон"}
        ];
      }
      if(color === "red" && body === "light"){
        return [
          {value:"bold",     label:"Жирное/солёное/кислое", hint:"Сливочный соус"},
          {value:"delicate", label:"Нежное",                 hint:"Ягодный соус"}
        ];
      }
      if(color === "white" && body === "full"){
        return [
          {value:"bold",     label:"Жирное/солёное/кислое", hint:"На гриле"},
          {value:"delicate", label:"Нежное",                 hint:"На пару"}
        ];
      }
      return [
        {value:"bold",     label:"Жирное/солёное/кислое", hint:"Овощи гриль"},
        {value:"delicate", label:"Нежное",                 hint:"Свежий салат"}
      ];
    }
    function hintsForAroma(ans){
      const {color, body} = ans;
      if(color === "red" && body === "full"){
        return [
          {value:"spicy",   label:"Пряное/ароматное",      hint:"Соус Пеппер"},
          {value:"neutral", label:"Не пряное/не ароматное",hint:"Чистый вкус"}
        ];
      }
      if(color === "red" && body === "light"){
        return [
          {value:"spicy",   label:"Пряное/ароматное",      hint:"Можжевельник, Розмарин"},
          {value:"neutral", label:"Не пряное/не ароматное",hint:"Чистый вкус"}
        ];
      }
      if(color === "white" && body === "full"){
        return [
          {value:"spicy",   label:"Пряное/ароматное",      hint:"Кисло-сладкий азиатский"},
          {value:"neutral", label:"Не пряное/не ароматное",hint:"Чистый вкус"}
        ];
      }
      return [
        {value:"spicy",   label:"Пряное/ароматное",      hint:"Тимьян, Шалфей, Цитрусы"},
        {value:"neutral", label:"Не пряное/не ароматное",hint:"Чистый вкус"}
      ];
    }

    // ===== 12 РЕЗУЛЬТАТОВ =====
    const RESULTS = {
      cab_malbec: {
        title:"Каберне Совиньон (Бордо), Мальбек (Аргентина)",
        desc:"Структура и спелая мощь для стейков и томлёных соусов. Просите выдержку и 16–18°C.",
        tags:["Плотное","Высокий танин","Стейк/гриль"]
      },
      syrah_shiraz: {
        title:"Сира (Рона), Шираз (Австралия)",
        desc:"Тёмная ягода и перечные специи — к грилю, копчёностям и глазировкам.",
        tags:["Пряность","Гриль/BBQ","Сочное"]
      },
      tempranillo_merlot: {
        title:"Темпранильо (Рибера дель Дуэро), Мерло",
        desc:"Бархатистая текстура и спелый фрукт — к телятине, свинине, рагу.",
        tags:["Среднее тело","Фрукты","Гастрономично"]
      },
      cab_franc: {
        title:"Каберне Фран (Луара)",
        desc:"Холодная ягода, лист смородины и лёгкая пряность — к птице на гриле и овощам.",
        tags:["Свежесть","Умеренный танин","Птица/овощи"]
      },
      sangiovese_chianti: {
        title:"Санджовезе (Кьянти)",
        desc:"Вишня, травы и живая кислотность — к томатным соусам, пасте и пицце.",
        tags:["Италия","Томаты","Кислотность"]
      },
      pinot_noir: {
        title:"Пино Нуар (Бургундия)",
        desc:"Нежная красная ягода и тонкая землянистость — к утке, грибам, тунцу; подайте слегка охлаждённым.",
        tags:["Лёгкое красное","14–15°C","Изящность"]
      },
      sauv_blanc: {
        title:"Совиньон Блан (Марлборо, Новая Зеландия)",
        desc:"Хрусткость, лайм и зелень — к салатам, козьему сыру и белой рыбе.",
        tags:["Высокая кислотность","Цитрус/зелень","Холодная подача"]
      },
      riesling_gewurz: {
        title:"Рислинг (Германия), Гевюрцтраминер (Эльзас)",
        desc:"Фрукт и пряная ароматика — идеальны для азиатской кухни и пикантных соусов.",
        tags:["Ароматное белое","Азиатские блюда","Баланс сладости"]
      },
      chardonnay_chablis: {
        title:"Шардоне (Шабли)",
        desc:"Минеральная линия и кремовая фактура — к запечённой рыбе, сливочным соусам и морепродуктам.",
        tags:["Минеральность","Сливочность","Рыба/сливки"]
      },
      garganega_verona: {
        title:"Гарганега (Верона)",
        desc:"Нежные косточковые, миндаль и соль — для ризотто, овощей, белого мяса.",
        tags:["Soave-стиль","Нежное","Гибкая пара"]
      },
      verdejo_rueda: {
        title:"Вердехо (Руэда)",
        desc:"Свежесть и лёгкая фруктовость — универсальное сопровождение к лёгким закускам, салатам, рыбе и фуршетам.",
        tags:["Универсально","Фуршет","Лёгкие блюда"]
      },
      sparkling: {
        title:"Виура (Риоха), Пино Гриджио (Фриули)",
        desc:"От освежающей минеральности до фруктовой мягкости — подходит к закускам, сырам, морепродуктам и лёгким блюдам.",
        tags:["Высокая кислотность","Аперитив","Морепродукты"]
      },
    };

    // Матчинг
    function pickResult({ color, body, intensity, aroma }) {
      const MAP = {
        white: {
          light: {
            neutral: { delicate: "sparkling",          bold: "garganega_verona" },
            spicy:   { delicate: "verdejo_rueda",       bold: "verdejo_rueda" }
          },
          full: {
            neutral: { delicate: "chardonnay_chablis",  bold: "sauv_blanc" },
            spicy:   { delicate: "riesling_gewurz",     bold: "riesling_gewurz" }
          }
        },
        red: {
          light: {
            neutral: { delicate: "pinot_noir",          bold: "cab_franc" },
            spicy:   { delicate: "sangiovese_chianti",  bold: "sangiovese_chianti" }
          },
          full: {
            neutral: { delicate: "tempranillo_merlot",  bold: "cab_malbec" },
            spicy:   { delicate: "syrah_shiraz",        bold: "syrah_shiraz" }
          }
        }
      };
      try { return MAP[color][body][aroma][intensity] || "verdejo_rueda"; }
      catch { return "verdejo_rueda"; }
    }

    // ===== РЕНДЕР =====
    const root = document.getElementById('wine-quiz-root');
    const state = { step:0, answers:{} };

    function el(tag, props={}, children=[]){
      const n=document.createElement(tag); Object.assign(n, props);
      (Array.isArray(children)?children:[children]).filter(Boolean).forEach(c=>{
        if(typeof c==='string'){ n.appendChild(document.createTextNode(c)); } else n.appendChild(c);
      }); return n;
    }
    function progressPct(){ return Math.round((state.step/QUESTIONS_BASE.length)*100); }

    function getStepWithDynamicHints(idx){
      const base = QUESTIONS_BASE[idx];
      if(!base) return null;
      if(base.id === "body")      return {...base, options: hintsForBody(state.answers)};
      if(base.id === "intensity") return {...base, options: hintsForIntensity(state.answers)};
      if(base.id === "aroma")     return {...base, options: hintsForAroma(state.answers)};
      return base;
    }

    function render(){
      root.innerHTML='';
      const shell=el('div',{id:'wine-quiz'});

      // Header
      const header=el('div',{className:'wq-header wq-screen'},[
        el('div',{className:'wq-kicker'},'MODERATO — Фудпейринг'),
        el('h2',{className:'wq-title'},'Подберите вино к блюду за 4 шага'),
        el('p',{className:'wq-sub'},'Цвет → Вес → Кислотность/Насыщенность → Аромат.'),
        (()=>{ const bar=el('div',{className:'wq-progress'},[el('span')]);
          requestAnimationFrame(()=>{ bar.firstChild.style.width=progressPct()+'%'; }); return bar;})()
      ]);
      shell.appendChild(header);

      const body=el('div',{className:'wq-body wq-screen'});

      if(state.step < QUESTIONS_BASE.length){
        const q = getStepWithDynamicHints(state.step);
        if(q.title) body.appendChild(el('div',{className:'wq-kicker'}, q.title));
        body.appendChild(el('h3',{className:'wq-question'}, q.question));
        if(q.note)  body.appendChild(el('p',{className:'wq-sub'}, q.note));

        const list=el('div',{className:'wq-options'});
        q.options.forEach(opt=>{
          const card=el('button',{className:'wq-option',type:'button'});
          card.appendChild(el('strong',{},opt.label));
          if(opt.hint) card.appendChild(el('small',{},opt.hint));
          card.addEventListener('click',()=>{
            state.answers[q.id]=opt.value;
            state.step++; render();
          });
          list.appendChild(card);
        });
        body.appendChild(list);

      } else {
        const resId = pickResult(state.answers);
        const r = RESULTS[resId];

        body.appendChild(el('div',{className:'wq-result'},[
          el('h3',{}, r.title),
          el('p',{}, r.desc),
          el('div',{className:'wq-tags'}, r.tags.map(t=>el('span',{className:'wq-tag'}, t)))
        ]));

        // CTA
        const cta=el('div',{className:'wq-cta'},[
          el('p',{}, 'Хотите подбирать вино так же уверенно — но без подсказок и тестов? На курсе «Азбука вина» мы учим этому вживую.'),
        ]);
        body.appendChild(cta);
      }

      // Навигация (нижняя панель)
      const nav=el('div',{className:'wq-nav wq-screen'});
      const left=el('div',{className:'wq-left'});
      const right=el('div',{className:'wq-right'});

      const backBtn=el('button',{className:'wq-btn wq-btn--outline',type:'button',disabled:state.step===0},'Назад');
      backBtn.addEventListener('click',()=>{ if(state.step>0){ state.step--; } render();});

      const resetBtn=el('button',{className:'wq-btn',type:'button'},'Сначала');
      resetBtn.addEventListener('click',()=>{ state.step=0; state.answers={}; render();});

      left.appendChild(backBtn);
      left.appendChild(resetBtn);

      // ⤵ Добавляем кнопку записи в правый нижний угол только на экране результата
      if(state.step >= QUESTIONS_BASE.length){
        const enrollBtn = el(
          'a',
          {
            className:'wq-btn wq-btn--accent',
            href:'https://moderato-sv.ru/abc_wine/?utm_source=foodpairing',
            target:'_blank',
            rel:'noopener',
            'aria-label':'Подробнее о курсе «Азбука вина»'
          },
          'Подробнее о курсе'
        );
        right.appendChild(enrollBtn);
      }

      nav.appendChild(left);
      nav.appendChild(right);

      shell.appendChild(body);
      shell.appendChild(nav);
      root.appendChild(shell);
    }

    function init(){ state.step=0; state.answers={}; render(); }
    if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', init); } else { init(); }
  })();
  </script>
</body>
</html>
